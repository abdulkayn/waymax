{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TwilsockConnector = void 0;\n\nconst uuid = require(\"uuid\");\n\nconst connector_1 = require(\"./connector\");\n\nconst DEFAULT_TTL = 60 * 60 * 48;\n/**\n * Registrar connector implementation for twilsock\n */\n\nclass TwilsockConnector extends connector_1.Connector {\n  constructor(context, twilsock, config) {\n    super(config);\n    this.twilsock = twilsock;\n    this.context = context;\n    context.id = uuid.v4();\n    this.twilsock.on('stateChanged', state => {\n      if (state !== 'connected') {\n        this.emit('transportReady', false);\n      }\n    });\n    this.twilsock.on('registered', id => {\n      if (context && id === context.id && twilsock.state === 'connected') {\n        this.emit('transportReady', true);\n      }\n    });\n  }\n\n  setNotificationId() {}\n\n  updateToken(token) {// no need to do anything here, twilsock backend handles it on it's own\n    // so just ignoring here\n  }\n\n  async updateContextRequest(messageTypes) {\n    let context = {\n      product_id: this.context.productId,\n      notification_protocol_version: 4,\n      endpoint_platform: this.context.platform,\n      message_types: messageTypes\n    };\n    this.emit('transportReady', false);\n    await this.twilsock.setNotificationsContext(this.context.id, context);\n  }\n\n  async updateRegistration(registration, reasons) {\n    if (!reasons.has('messageType')) {\n      return;\n    }\n\n    await this.updateContextRequest(Array.from(registration.messageTypes));\n    return registration;\n  }\n\n  removeRegistration() {\n    return this.twilsock.removeNotificationsContext(this.context.id);\n  }\n\n}\n\nexports.TwilsockConnector = TwilsockConnector;","map":{"version":3,"sources":["/Users/abdulkhan/Documents/waymax/Waymax/node_modules/twilio-notifications/lib/twilsock.connector.js"],"names":["Object","defineProperty","exports","value","TwilsockConnector","uuid","require","connector_1","DEFAULT_TTL","Connector","constructor","context","twilsock","config","id","v4","on","state","emit","setNotificationId","updateToken","token","updateContextRequest","messageTypes","product_id","productId","notification_protocol_version","endpoint_platform","platform","message_types","setNotificationsContext","updateRegistration","registration","reasons","has","Array","from","removeRegistration","removeNotificationsContext"],"mappings":"AAAA;;AACAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;AACAD,OAAO,CAACE,iBAAR,GAA4B,KAAK,CAAjC;;AACA,MAAMC,IAAI,GAAGC,OAAO,CAAC,MAAD,CAApB;;AACA,MAAMC,WAAW,GAAGD,OAAO,CAAC,aAAD,CAA3B;;AACA,MAAME,WAAW,GAAG,KAAK,EAAL,GAAU,EAA9B;AACA;AACA;AACA;;AACA,MAAMJ,iBAAN,SAAgCG,WAAW,CAACE,SAA5C,CAAsD;AAClDC,EAAAA,WAAW,CAACC,OAAD,EAAUC,QAAV,EAAoBC,MAApB,EAA4B;AACnC,UAAMA,MAAN;AACA,SAAKD,QAAL,GAAgBA,QAAhB;AACA,SAAKD,OAAL,GAAeA,OAAf;AACAA,IAAAA,OAAO,CAACG,EAAR,GAAaT,IAAI,CAACU,EAAL,EAAb;AACA,SAAKH,QAAL,CAAcI,EAAd,CAAiB,cAAjB,EAAiCC,KAAK,IAAI;AACtC,UAAIA,KAAK,KAAK,WAAd,EAA2B;AACvB,aAAKC,IAAL,CAAU,gBAAV,EAA4B,KAA5B;AACH;AACJ,KAJD;AAKA,SAAKN,QAAL,CAAcI,EAAd,CAAiB,YAAjB,EAA+BF,EAAE,IAAI;AACjC,UAAIH,OAAO,IAAIG,EAAE,KAAKH,OAAO,CAACG,EAA1B,IAAgCF,QAAQ,CAACK,KAAT,KAAmB,WAAvD,EAAoE;AAChE,aAAKC,IAAL,CAAU,gBAAV,EAA4B,IAA5B;AACH;AACJ,KAJD;AAKH;;AACDC,EAAAA,iBAAiB,GAAU,CAAG;;AAC9BC,EAAAA,WAAW,CAACC,KAAD,EAAQ,CACf;AACA;AACH;;AACyB,QAApBC,oBAAoB,CAACC,YAAD,EAAe;AACrC,QAAIZ,OAAO,GAAG;AACVa,MAAAA,UAAU,EAAE,KAAKb,OAAL,CAAac,SADf;AAEVC,MAAAA,6BAA6B,EAAE,CAFrB;AAGVC,MAAAA,iBAAiB,EAAE,KAAKhB,OAAL,CAAaiB,QAHtB;AAIVC,MAAAA,aAAa,EAAEN;AAJL,KAAd;AAMA,SAAKL,IAAL,CAAU,gBAAV,EAA4B,KAA5B;AACA,UAAM,KAAKN,QAAL,CAAckB,uBAAd,CAAsC,KAAKnB,OAAL,CAAaG,EAAnD,EAAuDH,OAAvD,CAAN;AACH;;AACuB,QAAlBoB,kBAAkB,CAACC,YAAD,EAAeC,OAAf,EAAwB;AAC5C,QAAI,CAACA,OAAO,CAACC,GAAR,CAAY,aAAZ,CAAL,EAAiC;AAC7B;AACH;;AACD,UAAM,KAAKZ,oBAAL,CAA0Ba,KAAK,CAACC,IAAN,CAAWJ,YAAY,CAACT,YAAxB,CAA1B,CAAN;AACA,WAAOS,YAAP;AACH;;AACDK,EAAAA,kBAAkB,GAAG;AACjB,WAAO,KAAKzB,QAAL,CAAc0B,0BAAd,CAAyC,KAAK3B,OAAL,CAAaG,EAAtD,CAAP;AACH;;AAzCiD;;AA2CtDZ,OAAO,CAACE,iBAAR,GAA4BA,iBAA5B","sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TwilsockConnector = void 0;\nconst uuid = require(\"uuid\");\nconst connector_1 = require(\"./connector\");\nconst DEFAULT_TTL = 60 * 60 * 48;\n/**\n * Registrar connector implementation for twilsock\n */\nclass TwilsockConnector extends connector_1.Connector {\n    constructor(context, twilsock, config) {\n        super(config);\n        this.twilsock = twilsock;\n        this.context = context;\n        context.id = uuid.v4();\n        this.twilsock.on('stateChanged', state => {\n            if (state !== 'connected') {\n                this.emit('transportReady', false);\n            }\n        });\n        this.twilsock.on('registered', id => {\n            if (context && id === context.id && twilsock.state === 'connected') {\n                this.emit('transportReady', true);\n            }\n        });\n    }\n    setNotificationId(...args) { }\n    updateToken(token) {\n        // no need to do anything here, twilsock backend handles it on it's own\n        // so just ignoring here\n    }\n    async updateContextRequest(messageTypes) {\n        let context = {\n            product_id: this.context.productId,\n            notification_protocol_version: 4,\n            endpoint_platform: this.context.platform,\n            message_types: messageTypes\n        };\n        this.emit('transportReady', false);\n        await this.twilsock.setNotificationsContext(this.context.id, context);\n    }\n    async updateRegistration(registration, reasons) {\n        if (!reasons.has('messageType')) {\n            return;\n        }\n        await this.updateContextRequest(Array.from(registration.messageTypes));\n        return registration;\n    }\n    removeRegistration() {\n        return this.twilsock.removeNotificationsContext(this.context.id);\n    }\n}\nexports.TwilsockConnector = TwilsockConnector;\n"]},"metadata":{},"sourceType":"script"}